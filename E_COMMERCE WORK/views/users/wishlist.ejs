<%- include('../partials/header') %>
	
<style>

.navbar-toggler {
        border: none;
        font-size: 24px;
    }

    .navbar-toggler:focus {
        outline: none;
    }

    .navbar-nav {
        display: flex;
        flex-direction: column;
        text-align: center;
    }

    .navbar-nav .nav-item {
        margin-bottom: 10px;
    }

    .navbar-nav .nav-link {
        padding: 10px 0;
        font-size: 18px;
    }

    @media (min-width: 768px) {
        .navbar-nav {
            flex-direction: row;
            justify-content: flex-end;
            text-align: left;
        }

        .navbar-nav .nav-item {
            margin-bottom: 0;
            margin-left: 20px;
        }

        .navbar-nav .nav-link {
            padding: 5px 0;
            font-size: 16px;
        }
    }
.wishlist-header, .wishlist-item {
  border-bottom: 1px solid #e0e0e0;
  padding: 15px 0;
}

.wishlist-header {
  font-weight: bold;
  background-color: #f8f9fa;
}

.w-40 { width: 40%; }
.w-15 { width: 15%; }

.product-name {
  font-size: 18px;
  margin-bottom: 5px;
}

.product-description {
  font-size: 14px;
  color: #6c757d;
}

.stock-status {
  font-weight: bold;
}

.add-to-cart-btn {
  width: 100%;
  max-width: 150px;
}

.remove-btn {
  padding: 5px 10px;
}
</style>
<div class="colorlib-loader"></div>

<div id="page">
  <nav class="colorlib-nav" role="navigation">
    <div class="top-menu">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-6 col-md-9">
                    <div id="colorlib-logo"><a href="/home">EYEGAZE</a></div>
                </div>
                <div class="col-6 col-md-3 text-right">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon">&#9776;</span>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="collapse navbar-collapse" id="navbarContent">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item active"><a class="nav-link" href="index.html">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="/product">Shop</a></li>
                            <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                            <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
                            <li class="nav-item"><a class="nav-link" href="/myaccount">My Account</a></li>
                            <li class="nav-item cart">
                                <a class="nav-link" href="/cart"><i class="icon-shopping-cart"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sale">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <div class="owl-carousel2">
                        <div class="item">
                            <div class="col">
                                <h3><a href="/cart">Click here to view your cart</a></h3>
                            </div>
                        </div>
                        <div class="item">
                            <div class="col">
                                <h3><a href="/cart">Click here to view your cart</a></h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

    <div class="breadcrumbs">
        <div class="container">
            <div class="row">
                <div class="col">
                    <p class="bread"><span><a href="/product">Shop</a></span> / <span>wishlist</span></p>
                </div>
            </div>
        </div>
    </div>


    <div class="colorlib-product">
        <div class="container">
            <div class="row row-pb-lg">
                <div class="col-md-10 offset-md-1">
                    
                </div>
            </div>
            <!-- here -->
            <div class="row row-pb-lg">
                <div class="col-md-12">
                  <div class="wishlist-header d-flex">
                    <div class="w-40 text-left px-4">
                      <span>Product Details</span>
                    </div>
                    <div class="w-15 text-center">
                      <span>Price</span>
                    </div>
                    <div class="w-15 text-center">
                      <span>Stock Status</span>
                    </div>
                    <div class="w-15 text-center">
                      <span>Action</span>
                    </div>
                    <div class="w-15 text-center px-4">
                      <span>Remove</span>
                    </div>
                  </div>
                  
                  <!-- Wishlist Item -->
                  <% whishlist.products.forEach((item, index) => { %> 
                  <div class="wishlist-item d-flex align-items-center">
                    <div class="w-40 d-flex align-items-center">
                      <div class="product-img mr-3">
                        <img src="/productimage/<%=item.product.productimages[0]%>" alt="Product Image" class="img-fluid" style="max-width: 100px;">
                      </div>
                      <div class="product-info">
                        <h3 class="product-name"><%=item.product.productName%></h3>
                     
                      </div>
                    </div>
                    <% if (item.discountPrice < item.product.price) { %>
                    <div class="w-15 text-center">
                      <span class="price text-success">&#8377;<%=item.discountPrice%></span>
                    </div>
                    <% } else { %>
                      <div class="w-15 text-center">
                        <span class="price text-success">&#8377;<%= item.product.price %></span>
                      </div>
                      <% } %>

                    <div class="w-15 text-center">
                      <% if (item.product.stock>0) { %>
                      <span class="stock-status text-success">In Stock</span>
                      <% } else { %>
                        <span class="stock-status text-success">out of Stock</span>
                        <% } %>
                    </div>
                    <div class="w-15 text-center">
                      <button class="btn btn-primary add-to-cart-btn" onclick="wishlistAddCart('<%=item.product._id%>')">Add to Cart</button>
                    </div>
                    <div class="w-15 text-center">
                        <button class="btn btn-outline-danger remove-btn" onclick="removeFromWishlist('<%=item.product._id%>')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              <line x1="18" y1="6" x2="6" y2="18"></line>
                              <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                          </button>
                    </div>
                  </div>
                  <% })%>
                  <!-- End Wishlist Item -->
                </div>
              </div>
              
            <div class="row row-pb-lg">
                <div class="col-md-12">
                    <div class="total-wrap">
                        <div class="row">
                          
                    
                            <div class="col-sm-4 text-center">
                                <div class="total">
                                  
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<script>

function wishlistAddCart(productId) {
  fetch(`/wishlist/addtocart/${productId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => {
    if (response.redirected) {
      window.location.href = response.url;
      return;
    }
    return response.json();
  })
  .then(data => {
    if (data.message === 'Product already in cart') {
      Swal.fire({
        title: 'Info',
        text: 'This product is already in your cart.',
        icon: 'info',
        confirmButtonText: 'OK'
      });
    } else if (data.message === 'Product added to cart') {
  Swal.fire({
    title: 'Success',
    text: 'Product added to cart successfully.',
    icon: 'success',
    confirmButtonText: 'OK'
  }).then(() => {
    location.reload(); // Reload the page after success
  });
}else {
      Swal.fire({
        title: 'Error',
        text: data.message || 'Something went wrong.',
        icon: 'error',
        confirmButtonText: 'OK'
      });
    }
  })
  .catch(error => {
    console.error('Error:', error);
    Swal.fire({
      title: 'Error',
      text: 'Server error. Please try again later.',
      icon: 'error',
      confirmButtonText: 'OK'
    });
  });
}



function removeFromWishlist(productId) {
  Swal.fire({
    title: 'Are you sure?',
    text: 'Do you really want to remove this product from your wishlist?',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, remove it!',
    cancelButtonText: 'No, cancel!'
  }).then((result) => {
    if (result.isConfirmed) {
      // Send a DELETE request to remove the product from the wishlist
      fetch(`/wishlist/delete/${productId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Notify the user that the product has been removed and reload the page
          Swal.fire(
            'Removed!',
            'The product has been removed from your wishlist.',
            'success'
          ).then(() => {
            location.reload(); // Reload the page after successful removal
          });
        } else {
          // Notify the user of any errors that occurred during the removal process
          Swal.fire(
            'Error!',
            'Failed to remove the product from your wishlist.',
            'error'
          );
        }
      })
      .catch(error => {
        console.error('Error:', error);
        // Notify the user if there was an issue with the request
        Swal.fire(
          'Error!',
          'There was an issue with the request.',
          'error'
        );
      });
    }
  });
}

</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/jquery.min.js"></script>
   <!-- popper -->
   <script src="/js/popper.min.js"></script>
   <!-- bootstrap 4.1 -->
   <script src="/js/bootstrap.min.js"></script>
   <!-- jQuery easing -->
   <script src="/js/jquery.easing.1.3.js"></script>
	<!-- Waypoints -->
	<script src="/js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="/js/jquery.flexslider-min.js"></script>
	<!-- Owl carousel -->
	<script src="/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="/js/jquery.magnific-popup.min.js"></script>
	<script src="/js/magnific-popup-options.js"></script>
	<!-- Date Picker -->
	
	<!-- Main -->
	<script src="/js/main.js"></script>
   

<%- include('../partials/footer') %>

